schema: '2.0'
stages:
  train:
    cmd: python -m deckard.layers.experiment train --config_file cifar100.yaml
    params:
      params.yaml:
        data:
          _target_: deckard.base.data.Data
          generate:
            name: torch_cifar100
            path: original_data
          sample:
            random_state: 0
            stratify: true
          sklearn_pipeline:
            preprocessor:
              name: sklearn.preprocessing.StandardScaler
              with_mean: true
              with_std: true
        files:
          _target_: deckard.base.files.FileConfig
          adv_predictions_file: adv_predictions.json
          attack_dir: attacks
          attack_file: attack
          attack_type: .pkl
          data_dir: data
          data_file: data
          data_type: .pkl
          directory: cifar100
          model_dir: models
          model_file: model
          model_type: .pt
          name: default
          params_file: params.yaml
          predictions_file: predictions.json
          reports: reports
          score_dict_file: score_dict.json
        model:
          _target_: deckard.base.model.Model
          art:
            _target_: deckard.base.model.art_pipeline.ArtPipeline
            data:
              _target_: deckard.base.data.Data
              generate:
                name: torch_cifar100
                path: original_data
              sample:
                random_state: 0
                stratify: true
              sklearn_pipeline:
                preprocessor:
                  name: sklearn.preprocessing.StandardScaler
                  with_mean: true
                  with_std: true
            initialize:
              clip_values:
              - 0
              - 255
              criterion:
                name: torch.nn.CrossEntropyLoss
              optimizer:
                lr: 0.01
                momentum: 0.9
                name: torch.optim.SGD
            library: pytorch
          data:
            _target_: deckard.base.data.Data
            generate:
              name: torch_cifar100
              path: original_data
            sample:
              random_state: 0
              stratify: true
            sklearn_pipeline:
              preprocessor:
                name: sklearn.preprocessing.StandardScaler
                with_mean: true
                with_std: true
          init:
            _target_: deckard.base.model.ModelInitializer
            name: torch_example.ResNet18
            num_channels: 3
            num_classes: 100
          library: pytorch
          trainer:
            batch_size: 1024
            nb_epoch: 10
        scorers:
          _target_: deckard.base.scorer.ScorerDict
          accuracy:
            _target_: deckard.base.scorer.ScorerConfig
            direction: maximize
            name: sklearn.metrics.accuracy_score
          log_loss:
            _target_: deckard.base.scorer.ScorerConfig
            direction: minimize
            name: sklearn.metrics.log_loss
    outs:
    - path: cifar100/data/data.pkl
      md5: 1070854e6c00fc787bc0fdfc82792fd6
      size: 761280311
    - path: cifar100/reports/train/default/predictions.json
      md5: ae8fc23c617a98ec2ce2f7fa59a996ca
      size: 24417256
    - path: cifar100/reports/train/default/score_dict.json
      md5: cc8d94e9b560116b38a50ce4067f6979
      size: 881
  attack:
    cmd: python -m deckard.layers.experiment attack --config_file cifar100.yaml
    deps:
    - path: cifar100/data/data.pkl
      md5: 1070854e6c00fc787bc0fdfc82792fd6
      size: 761280311
    params:
      params.yaml:
        attack:
          _target_: deckard.base.attack.Attack
          attack_size: 10
          data:
            _target_: deckard.base.data.Data
            generate:
              name: torch_cifar100
              path: original_data
            sample:
              random_state: 0
              stratify: true
            sklearn_pipeline:
              preprocessor:
                name: sklearn.preprocessing.StandardScaler
                with_mean: true
                with_std: true
          init:
            _target_: deckard.base.attack.AttackInitializer
            model:
              _target_: deckard.base.model.Model
              art:
                _target_: deckard.base.model.art_pipeline.ArtPipeline
                data:
                  _target_: deckard.base.data.Data
                  generate:
                    name: torch_cifar100
                    path: original_data
                  sample:
                    random_state: 0
                    stratify: true
                  sklearn_pipeline:
                    preprocessor:
                      name: sklearn.preprocessing.StandardScaler
                      with_mean: true
                      with_std: true
                initialize:
                  clip_values:
                  - 0
                  - 255
                  criterion:
                    name: torch.nn.CrossEntropyLoss
                  optimizer:
                    lr: 0.01
                    momentum: 0.9
                    name: torch.optim.SGD
                library: pytorch
              data:
                _target_: deckard.base.data.Data
                generate:
                  name: torch_cifar100
                  path: original_data
                sample:
                  random_state: 0
                  stratify: true
                sklearn_pipeline:
                  preprocessor:
                    name: sklearn.preprocessing.StandardScaler
                    with_mean: true
                    with_std: true
              init:
                _target_: deckard.base.model.ModelInitializer
                name: torch_example.ResNet18
                num_channels: 3
                num_classes: 100
              library: pytorch
              trainer:
                batch_size: 1024
                nb_epoch: 10
            name: art.attacks.evasion.HopSkipJump
          method: evasion
          model:
            _target_: deckard.base.model.Model
            art:
              _target_: deckard.base.model.art_pipeline.ArtPipeline
              data:
                _target_: deckard.base.data.Data
                generate:
                  name: torch_cifar100
                  path: original_data
                sample:
                  random_state: 0
                  stratify: true
                sklearn_pipeline:
                  preprocessor:
                    name: sklearn.preprocessing.StandardScaler
                    with_mean: true
                    with_std: true
              initialize:
                clip_values:
                - 0
                - 255
                criterion:
                  name: torch.nn.CrossEntropyLoss
                optimizer:
                  lr: 0.01
                  momentum: 0.9
                  name: torch.optim.SGD
              library: pytorch
            data:
              _target_: deckard.base.data.Data
              generate:
                name: torch_cifar100
                path: original_data
              sample:
                random_state: 0
                stratify: true
              sklearn_pipeline:
                preprocessor:
                  name: sklearn.preprocessing.StandardScaler
                  with_mean: true
                  with_std: true
            init:
              _target_: deckard.base.model.ModelInitializer
              name: torch_example.ResNet18
              num_channels: 3
              num_classes: 100
            library: pytorch
            trainer:
              batch_size: 1024
              nb_epoch: 10
        data:
          _target_: deckard.base.data.Data
          generate:
            name: torch_cifar100
            path: original_data
          sample:
            random_state: 0
            stratify: true
          sklearn_pipeline:
            preprocessor:
              name: sklearn.preprocessing.StandardScaler
              with_mean: true
              with_std: true
        files:
          _target_: deckard.base.files.FileConfig
          adv_predictions_file: adv_predictions.json
          attack_dir: attacks
          attack_file: attack
          attack_type: .pkl
          data_dir: data
          data_file: data
          data_type: .pkl
          directory: cifar100
          model_dir: models
          model_file: model
          model_type: .pt
          name: default
          params_file: params.yaml
          predictions_file: predictions.json
          reports: reports
          score_dict_file: score_dict.json
        model:
          _target_: deckard.base.model.Model
          art:
            _target_: deckard.base.model.art_pipeline.ArtPipeline
            data:
              _target_: deckard.base.data.Data
              generate:
                name: torch_cifar100
                path: original_data
              sample:
                random_state: 0
                stratify: true
              sklearn_pipeline:
                preprocessor:
                  name: sklearn.preprocessing.StandardScaler
                  with_mean: true
                  with_std: true
            initialize:
              clip_values:
              - 0
              - 255
              criterion:
                name: torch.nn.CrossEntropyLoss
              optimizer:
                lr: 0.01
                momentum: 0.9
                name: torch.optim.SGD
            library: pytorch
          data:
            _target_: deckard.base.data.Data
            generate:
              name: torch_cifar100
              path: original_data
            sample:
              random_state: 0
              stratify: true
            sklearn_pipeline:
              preprocessor:
                name: sklearn.preprocessing.StandardScaler
                with_mean: true
                with_std: true
          init:
            _target_: deckard.base.model.ModelInitializer
            name: torch_example.ResNet18
            num_channels: 3
            num_classes: 100
          library: pytorch
          trainer:
            batch_size: 1024
            nb_epoch: 10
        scorers:
          _target_: deckard.base.scorer.ScorerDict
          accuracy:
            _target_: deckard.base.scorer.ScorerConfig
            direction: maximize
            name: sklearn.metrics.accuracy_score
          log_loss:
            _target_: deckard.base.scorer.ScorerConfig
            direction: minimize
            name: sklearn.metrics.log_loss
    outs:
    - path: cifar100/attacks/attack.pkl
      md5: ce61a27e5d15756510cba20184f87c6a
      size: 123046
    - path: cifar100/reports/attack/default/adv_predictions.json
      md5: a116525fa654fb44d2b5bef716a57c21
      size: 21294
    - path: cifar100/reports/attack/default/score_dict.json
      md5: cc6250493ce23c358493e58248580470
      size: 1349
  attacks@ResNet18:
    cmd: bash attacks.sh ++attack.attack_size=100 ++model.init.name=torch_example.ResNet18
      stage=attack ++hydra.sweeper.storage=sqlite:///cifar100/reports/attack/ResNet18.db
      --config-name cifar100.yaml
    deps:
    - path: attacks.sh
      md5: d78e6d6b697480fbccfb58bd791af506
      size: 2897
    - path: cifar100/reports/attack/default/score_dict.json
      md5: cc6250493ce23c358493e58248580470
      size: 1349
    - path: models.sh
      md5: 1937e58bedac027034aea7d4a5712407
      size: 1380
    outs:
    - path: cifar100/reports/attack/ResNet18.db
      md5: a92cd9f6c41853a0752f3d8b3bcc5c5d
      size: 450560
  attacks@ResNet152:
    cmd: bash attacks.sh ++attack.attack_size=100 ++model.init.name=torch_example.ResNet152
      stage=attack ++hydra.sweeper.storage=sqlite:///cifar100/reports/attack/ResNet152.db
      --config-name cifar100.yaml
    deps:
    - path: attacks.sh
      md5: d78e6d6b697480fbccfb58bd791af506
      size: 2897
    - path: cifar100/reports/attack/default/score_dict.json
      md5: cc6250493ce23c358493e58248580470
      size: 1349
    - path: models.sh
      md5: 1937e58bedac027034aea7d4a5712407
      size: 1380
    outs:
    - path: cifar100/reports/attack/ResNet152.db
      md5: 4350bd46825aec423f0697eafd8bab5c
      size: 450560
  attacks@ResNet34:
    cmd: bash attacks.sh ++attack.attack_size=100 ++model.init.name=torch_example.ResNet34
      stage=attack ++hydra.sweeper.storage=sqlite:///cifar100/reports/attack/ResNet34.db
      --config-name cifar100.yaml
    deps:
    - path: attacks.sh
      md5: d78e6d6b697480fbccfb58bd791af506
      size: 2897
    - path: cifar100/reports/attack/default/score_dict.json
      md5: cc6250493ce23c358493e58248580470
      size: 1349
    - path: models.sh
      md5: 1937e58bedac027034aea7d4a5712407
      size: 1380
    outs:
    - path: cifar100/reports/attack/ResNet34.db
      md5: 14cee99bc02f11e3cddd61d012fa9d7a
      size: 450560
  attacks@ResNet50:
    cmd: bash attacks.sh ++attack.attack_size=100 ++model.init.name=torch_example.ResNet50
      stage=attack ++hydra.sweeper.storage=sqlite:///cifar100/reports/attack/ResNet50.db
      --config-name cifar100.yaml
    deps:
    - path: attacks.sh
      md5: d78e6d6b697480fbccfb58bd791af506
      size: 2897
    - path: cifar100/reports/attack/default/score_dict.json
      md5: cc6250493ce23c358493e58248580470
      size: 1349
    - path: models.sh
      md5: 1937e58bedac027034aea7d4a5712407
      size: 1380
    outs:
    - path: cifar100/reports/attack/ResNet50.db
      md5: beed70d2d444ab0a701398cc356310cf
      size: 450560
  attacks@ResNet101:
    cmd: bash attacks.sh ++attack.attack_size=100 ++model.init.name=torch_example.ResNet101
      stage=attack ++hydra.sweeper.storage=sqlite:///cifar100/reports/attack/ResNet101.db
      --config-name cifar100.yaml
    deps:
    - path: attacks.sh
      md5: d78e6d6b697480fbccfb58bd791af506
      size: 2897
    - path: cifar100/reports/attack/default/score_dict.json
      md5: cc6250493ce23c358493e58248580470
      size: 1349
    - path: models.sh
      md5: 1937e58bedac027034aea7d4a5712407
      size: 1380
    outs:
    - path: cifar100/reports/attack/ResNet101.db
      md5: 536be9988a2320d99f09c861e0bcd347
      size: 450560
  compile@attack:
    cmd: python -m deckard.layers.compile --report_folder cifar100/reports/attack
      --results_file cifar100/reports/attack.csv
    deps:
    - path: cifar100/reports/attack/
      md5: 90b53d2ef28cb705a378b4ccc28ca86b.dir
      size: 195753796
      nfiles: 2888
    - path: cifar100/reports/attack/ResNet101.db
      md5: 536be9988a2320d99f09c861e0bcd347
      size: 450560
    - path: cifar100/reports/attack/ResNet152.db
      md5: 4350bd46825aec423f0697eafd8bab5c
      size: 450560
    - path: cifar100/reports/attack/ResNet18.db
      md5: a92cd9f6c41853a0752f3d8b3bcc5c5d
      size: 450560
    - path: cifar100/reports/attack/ResNet34.db
      md5: 14cee99bc02f11e3cddd61d012fa9d7a
      size: 450560
    - path: cifar100/reports/attack/ResNet50.db
      md5: beed70d2d444ab0a701398cc356310cf
      size: 450560
    outs:
    - path: cifar100/reports/attack.csv
      md5: 85de2012c07ede4d60c882b716355305
      size: 3512767
  plot:
    cmd: python -m deckard.layers.plots --path cifar100/plots/ --file cifar100/reports/attack.csv
      -o data.csv
    deps:
    - path: cifar100/reports/attack.csv
      md5: 85de2012c07ede4d60c882b716355305
      size: 3512767
    outs:
    - path: cifar100/plots/data.csv
      md5: 0ade05afcc3da9f9249a3140849a5f8c
      size: 2977261
  afr:
    cmd: python -m deckard.layers.afr --dataset cifar100 --data_file cifar100/plots/data.csv
      --target adv_accuracy --duration_col adv_fit_time --dataset cifar100
    deps:
    - path: cifar100/plots/data.csv
      md5: 0ade05afcc3da9f9249a3140849a5f8c
      size: 2977261
    outs:
    - path: cifar100/plots/aft_comparison.csv
      md5: 6ad56e75d18d7ea9349346b79a772167
      size: 239
    - path: cifar100/plots/aft_comparison.tex
      md5: 7fd18c110cfcbbaf15b593d533706ed7
      size: 893
    - path: cifar100/plots/cox_aft.pdf
      md5: 10bde6a3f3e7a8463424607968f3e4b5
      size: 30834
    - path: cifar100/plots/cox_partial_effects.pdf
      md5: 3695b911cc517cea981298a65a4ad484
      size: 38233
    - path: cifar100/plots/log_logistic_aft.pdf
      md5: beb231da66fec538d29b8511829232fc
      size: 33470
    - path: cifar100/plots/log_logistic_partial_effects.pdf
      md5: a362711d166b57a5fb10a098aabcd831
      size: 29667
    - path: cifar100/plots/log_normal_aft.pdf
      md5: 54b75851860d177c056ee6ca72ca7226
      size: 33983
    - path: cifar100/plots/log_normal_partial_effects.pdf
      md5: 8af43a32bdbba1686206882c3822922a
      size: 30232
    - path: cifar100/plots/weibull_aft.pdf
      md5: 2d7fa9a0bd0c0729d3492399a0d30178
      size: 31582
    - path: cifar100/plots/weibull_partial_effects.pdf
      md5: cde5790226086c2ea7567011fba527db
      size: 29933
  copy_results:
    cmd: cp -r cifar100/plots/* ~/ml_afr/cifar100/
    deps:
    - path: cifar100/plots/aft_comparison.csv
      md5: 6ad56e75d18d7ea9349346b79a772167
      size: 239
    - path: cifar100/plots/data.csv
      md5: 0ade05afcc3da9f9249a3140849a5f8c
      size: 2977261
